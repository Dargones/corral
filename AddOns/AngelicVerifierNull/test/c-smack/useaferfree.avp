GlobalDeclarations
{
var {:propertyMap} validFree : [int] bool;
function {:inline} isValid(p : int, m : [int]bool) returns(bool) {m[p] || p == 0}
function {:ReachableStates} NonNULL(bool) : bool;
}


TemplateVariables
{
var p : int;
//procedure anyProc(p : int, {:#AnyParameters} a : int) returns( {:#AnyParameters} r: int);
procedure {:#AnyArguments} anyProc({:pointer} q : int) returns( {:#AnyParameters} r: int);
//procedure anyProc(q : int, k:int) returns( {:#AnyParameters} r: int);
}

CmdRule
{
call anyProc(p);
}
-->
{
assert isValid(p, validFree);
assume NonNULL(p != 0);
#this;
}

ProcedureRule
{
procedure {:#NameMatches "^free_$"} builtin_free( p1 : int);
}
-->
{
validFree[p1] := false;
}

//ProcedureRule
//{
//procedure {:#HasImplementation} {:#NameMatches ".*"} fmDeleteArray( {:#AnyParameters} {:pointer} p1 : int) returns({:#AnyParameters} r: int);
//}
//-->
//{
//assert isValid(p1, validFree);
//}

